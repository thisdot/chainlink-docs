---
import { SvgArrowRight2, Typography } from "@chainlink/blocks"
import { searchClient } from "@algolia/client-search"
import ChangelogCard from "./ChangelogCard.astro"
import { ALGOLIA_INDEX, type ChangelogItem } from "./types"
import styles from "./ChangelogSnippet.module.css"

const appId = import.meta.env.PUBLIC_ALGOLIA_SEARCH_APP_ID
const apiKey = import.meta.env.PUBLIC_ALGOLIA_SEARCH_PUBLIC_API_KEY

const client = searchClient(appId, apiKey)

const req = await client.search({
  requests: [
    {
      indexName: ALGOLIA_INDEX.CHANGELOG,
      query: "data-feeds",
    },
  ],
})

const firstResult = req.results[0]
const results = "hits" in firstResult ? (firstResult.hits as ChangelogItem[]) : []
const latestLog = results[0]
---

{
  results.length > 0 && (
    <section class={styles.container}>
      <header class={styles.sectionHeader}>
        <Typography
          variant="h2"
          style={{
            fontSize: "32px",
          }}
        >
          Changelog
        </Typography>

        <a href="https://dev.chain.link/changelog" class={styles.arrow}>
          <SvgArrowRight2 height={12} width={12} />
        </a>
      </header>
      <ChangelogCard item={latestLog} />
    </section>
  )
}
